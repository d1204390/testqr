<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>條件式掃描</title>
    <!-- 引入 html5-qrcode (僅供一般瀏覽器使用) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
    <!-- 引入 LIFF SDK (僅供 LINE 內建瀏覽器使用) -->
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
</head>
<body>
<button id="startScanBtn">開始掃描</button>
<div id="reader" style="width:300px; height:300px;"></div>
<div id="result"></div>

<script>
    // 判斷是否為 LINE 內建瀏覽器
    function isLineBrowser() {
        return /Line\/[\d\.]+/.test(navigator.userAgent);
    }

    // 原本使用 html5-qrcode 的掃描方法
    function startHtml5QrScanner() {
        const html5QrcodeScanner = new Html5Qrcode("reader");
        const config = { fps: 10, qrbox: 250 };

        html5QrcodeScanner.start(
            { facingMode: "environment" },
            config,
            (decodedText, decodedResult) => {
                // 成功掃描後的 callback
                document.getElementById("result").innerText = "掃描結果：" + decodedText;
                html5QrcodeScanner.stop();
            },
            (errorMessage) => {
                // 掃描失敗的 callback
                console.warn("掃描失敗:", errorMessage);
            }
        ).catch(err => {
            console.error("啟動掃描器失敗:", err);
        });
    }

    // 使用 LIFF 的 scancodeV2 API 掃描
    function startLiffScan() {
        const liffId = "YOUR_LIFF_ID"; // 請換成你自己的 LIFF ID
        liff.init({ liffId })
            .then(() => {
                liff.scanCodeV2()
                    .then(result => {
                        // 掃描成功
                        document.getElementById("result").innerText = "掃描結果：" + result.value;
                    })
                    .catch(err => {
                        console.error("LIFF 掃描失敗:", err);
                    });
            })
            .catch(err => {
                console.error("LIFF 初始化失敗:", err);
            });
    }

    // 綁定按鈕事件
    document.getElementById("startScanBtn").addEventListener("click", () => {
        if (isLineBrowser()) {
            // 若為 LINE 內建瀏覽器，使用 LIFF 掃描
            startLiffScan();
        } else {
            // 其他瀏覽器使用 html5-qrcode
            startHtml5QrScanner();
        }
    });
</script>
</body>
</html>
